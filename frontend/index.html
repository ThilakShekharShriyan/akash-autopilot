<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Akash Autopilot - Autonomous AI Infrastructure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body class="bg-gray-900 text-gray-100">
    <div x-data="autopilot()" x-init="init()" class="min-h-screen">
        <!-- Header -->
        <header class="bg-gradient-to-r from-purple-600 to-blue-600 shadow-lg">
            <div class="container mx-auto px-6 py-8">
                <h1 class="text-4xl font-bold">ü§ñ Akash Autopilot</h1>
                <p class="text-xl mt-2 text-purple-100">Autonomous AI Infrastructure Operator</p>
            </div>
        </header>

        <!-- Main Content -->
        <div class="container mx-auto px-6 py-8">
            <!-- Why It's Cool Section -->
            <div class="bg-gray-800 rounded-lg p-6 mb-8 border border-purple-500">
                <h2 class="text-2xl font-bold mb-4 text-purple-400">üöÄ Why This Is Cool</h2>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <div class="text-3xl mb-2">ü§ñ</div>
                        <h3 class="font-bold text-lg mb-2">AI-Powered Decisions</h3>
                        <p class="text-gray-300 text-sm">Llama 3.3 70B analyzes your infrastructure and autonomously decides when to scale, redeploy, or optimize resources</p>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <div class="text-3xl mb-2">‚òÅÔ∏è</div>
                        <h3 class="font-bold text-lg mb-2">Decentralized Cloud</h3>
                        <p class="text-gray-300 text-sm">Running on Akash Network - 10x cheaper than AWS/GCP with no single point of failure</p>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <div class="text-3xl mb-2">‚ö°</div>
                        <h3 class="font-bold text-lg mb-2">Autonomous Operations</h3>
                        <p class="text-gray-300 text-sm">No human intervention needed - AI monitors 24/7 and takes action within safety guardrails</p>
                    </div>
                </div>
            </div>

            <!-- Live Status -->
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <!-- Agent Status -->
                <div class="bg-gray-800 rounded-lg p-6 border border-green-500">
                    <h2 class="text-2xl font-bold mb-4 text-green-400">Agent Status</h2>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-400">Status:</span>
                            <span class="font-bold" :class="status.running ? 'text-green-400' : 'text-red-400'">
                                <span x-show="status.running">‚óè RUNNING</span>
                                <span x-show="!status.running">‚óã STOPPED</span>
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Loop Count:</span>
                            <span class="font-mono text-blue-400" x-text="status.loop_count"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Last Loop:</span>
                            <span class="font-mono text-xs text-gray-300" x-text="formatTime(status.last_loop_time)"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Loop Interval:</span>
                            <span class="font-mono text-purple-400" x-text="status.configuration?.loop_interval + 's'"></span>
                        </div>
                    </div>
                </div>

                <!-- Database Stats -->
                <div class="bg-gray-800 rounded-lg p-6 border border-blue-500">
                    <h2 class="text-2xl font-bold mb-4 text-blue-400">Database Stats</h2>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-400">Total Actions:</span>
                            <span class="font-mono text-green-400" x-text="status.database_stats?.total_actions || 0"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Actions (Last Hour):</span>
                            <span class="font-mono text-yellow-400" x-text="status.database_stats?.actions_last_hour || 0"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Tracked Deployments:</span>
                            <span class="font-mono text-purple-400" x-text="status.database_stats?.tracked_deployments || 0"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Active Cooldowns:</span>
                            <span class="font-mono text-orange-400" x-text="status.database_stats?.active_cooldowns || 0"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Decisions -->
            <div class="bg-gray-800 rounded-lg p-6 mb-8 border border-yellow-500">
                <h2 class="text-2xl font-bold mb-4 text-yellow-400">üß† Recent AI Decisions</h2>
                <div class="space-y-4">
                    <template x-for="action in actions.slice(0, 5)" :key="action.id">
                        <div class="bg-gray-700 p-4 rounded border-l-4 border-purple-500">
                            <div class="flex justify-between mb-2">
                                <span class="font-bold" x-text="action.action_type"></span>
                                <span class="text-xs text-gray-400" x-text="formatTime(action.created_at)"></span>
                            </div>
                            <p class="text-sm text-gray-300 mb-2" x-text="action.reasoning"></p>
                            <div class="flex justify-between text-xs">
                                <span class="text-gray-400">Deployment: <span x-text="action.deployment_id"></span></span>
                                <span :class="{
                                    'text-green-400': action.status === 'completed',
                                    'text-yellow-400': action.status === 'pending',
                                    'text-red-400': action.status === 'failed'
                                }" x-text="action.status.toUpperCase()"></span>
                            </div>
                        </div>
                    </template>
                    <div x-show="actions.length === 0" class="text-center text-gray-500 py-8">
                        No AI decisions yet. The agent is monitoring and will take action when needed.
                    </div>
                </div>
            </div>

            <!-- Policy Guardrails -->
            <div class="bg-gray-800 rounded-lg p-6 border border-red-500">
                <h2 class="text-2xl font-bold mb-4 text-red-400">üõ°Ô∏è Safety Guardrails</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-bold mb-3 text-orange-400">Rate Limits</h3>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-400">Max Actions/Hour:</span>
                                <span class="font-mono" x-text="policy.rate_limits?.max_actions_per_hour"></span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-400">Max Actions/Day:</span>
                                <span class="font-mono" x-text="policy.rate_limits?.max_actions_per_day"></span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="font-bold mb-3 text-blue-400">Cooldowns</h3>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-400">Scale Cooldown:</span>
                                <span class="font-mono" x-text="formatDuration(policy.cooldowns?.scale_cooldown_seconds)"></span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-400">Redeploy Cooldown:</span>
                                <span class="font-mono" x-text="formatDuration(policy.cooldowns?.redeploy_cooldown_seconds)"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-gray-800 mt-12 py-6 border-t border-gray-700">
            <div class="container mx-auto px-6 text-center text-gray-400">
                <p>Running on <span class="text-purple-400 font-bold">Akash Network</span> | Powered by <span class="text-blue-400 font-bold">AkashML (Llama 3.3 70B)</span></p>
                <p class="text-sm mt-2">Cost: ~$0.80/month (vs $30-50/month on AWS/GCP)</p>
            </div>
        </footer>
    </div>

    <script>
        function autopilot() {
            return {
                apiUrl: '', // Will be set based on current location
                status: {
                    running: false,
                    loop_count: 0,
                    last_loop_time: null,
                    database_stats: {},
                    configuration: {}
                },
                actions: [],
                policy: {},
                
                init() {
                    // Use relative URLs - frontend and backend on same domain
                    this.apiUrl = '';
                    
                    this.fetchStatus();
                    this.fetchActions();
                    this.fetchPolicy();
                    
                    // Refresh every 10 seconds
                    setInterval(() => this.fetchStatus(), 10000);
                    setInterval(() => this.fetchActions(), 15000);
                },
                
                async fetchStatus() {
                    try {
                        const response = await fetch(`${this.apiUrl}/status`);
                        this.status = await response.json();
                    } catch (error) {
                        console.error('Error fetching status:', error);
                    }
                },
                
                async fetchActions() {
                    try {
                        const response = await fetch(`${this.apiUrl}/actions?limit=10`);
                        const data = await response.json();
                        this.actions = data.actions || [];
                    } catch (error) {
                        console.error('Error fetching actions:', error);
                    }
                },
                
                async fetchPolicy() {
                    try {
                        const response = await fetch(`${this.apiUrl}/policy`);
                        this.policy = await response.json();
                    } catch (error) {
                        console.error('Error fetching policy:', error);
                    }
                },
                
                formatTime(timestamp) {
                    if (!timestamp) return 'N/A';
                    return new Date(timestamp).toLocaleString();
                },
                
                formatDuration(seconds) {
                    if (!seconds) return 'N/A';
                    if (seconds < 60) return seconds + 's';
                    if (seconds < 3600) return Math.floor(seconds / 60) + 'm';
                    return Math.floor(seconds / 3600) + 'h';
                }
            }
        }
    </script>
</body>
</html>
